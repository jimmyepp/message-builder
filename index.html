<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Start a New Message</title>
  <link rel="stylesheet" href="style.css">  
</head>
<body>
    <div class="centered-content">
  <div class="wrapper">
    <h1>Welcome to the Message Builder</h1>
    <p>This tool will guide you step-by-step to build a clear, structured message. Ready?</p>

    <button onclick="startNewMessage()">Start New Message</button>
    <a href="my-drafts.html">View Saved Drafts</a>
    <button onclick="logout()">Logout</button>
  </div>
</div>
  <script type="module">
  import { db } from './firebase.js';
  import { doc, setDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js';

  function generateNewDraftId() {
    return Date.now().toString();
  }

  async function startNewMessage() {
    const userId = localStorage.getItem('userId');
    if (!userId) {
      window.location.href = 'login.html';
      return;
    }

    const newDraftId = generateNewDraftId();
    const newDraft = {
      id: newDraftId,
      title: '',
      createdAt: new Date().toISOString(),
      status: 'incomplete',
      messages: []
    };

    // Save to localStorage
    localStorage.setItem('messageDraft', JSON.stringify(newDraft));
    localStorage.setItem(`draft-${newDraftId}`, JSON.stringify(newDraft));

    // Save to Firestore
    await setDoc(doc(db, "users", userId, "drafts", newDraftId), {
      ...newDraft,
      createdAt: serverTimestamp()
    });

    // Redirect to step1
    window.location.href = `step1.html?draftId=${newDraftId}`;
  }

  window.startNewMessage = startNewMessage;
</script>



</body>
</html>
