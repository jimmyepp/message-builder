<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Step 6: Pick Supporting Points</title>
    <meta charset="UTF-8">
  <title>Step 1</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="centered-content">
  <div class="wrapper">
  <h1>Step 6 of 7</h1>

  <h2>Your Message So Far</h2>
  <p><strong>Audience:</strong> <span id="audience"></span></p>
  <p><strong>Topic:</strong> <span id="topic"></span></p>
  <p><strong>Recommendation:</strong> <span id="recommendation"></span></p>

  <h3>Select the 3 strongest points that support your recommendation:</h3>

<form id="step6Form" onsubmit="event.preventDefault(); nextStep();">    <ul id="supportingPointsList"></ul>
    <button type="submit">Next</button>
  </form>
</div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const draft = JSON.parse(localStorage.getItem('messageDraft')) || {};
    const uniquePoints = draft.uniquePoints || [];
    const benefitPoints = draft.benefits || [];
    const combinedPoints = [...uniquePoints, ...benefitPoints];

    // Debug output
    console.log("Draft loaded in Step 6:", draft);

    // Show topic, audience, recommendation
    document.getElementById('audience').textContent = draft.audience || '[Not set]';
    document.getElementById('topic').textContent = draft.topic || '[Not set]';
    document.getElementById('recommendation').textContent = draft.recommendation || '[Not set]';

    const list = document.getElementById('supportingPointsList');

    combinedPoints.forEach((point, index) => {
      const li = document.createElement('li');
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.value = point;
      checkbox.id = `point-${index}`;

      const label = document.createElement('label');
      label.htmlFor = `point-${index}`;
      label.textContent = point;

      li.appendChild(checkbox);
      li.appendChild(label);
      list.appendChild(li);
    });

    function saveToDraft(updates) {
      const existing = JSON.parse(localStorage.getItem('messageDraft')) || {};
      const updated = { ...existing, ...updates };
      localStorage.setItem('messageDraft', JSON.stringify(updated));
    }

    window.nextStep = function () {
      const selected = Array.from(document.querySelectorAll('input[type="checkbox"]:checked'))
        .map(cb => cb.value);

      if (selected.length !== 3) {
        alert("Please select exactly 3 supporting points.");
        return;
      }

      saveToDraft({ supportingPoints: selected });
      localStorage.setItem('supportingPoints', JSON.stringify(selected)); // optional redundancy
      window.location.href = 'step7.html';
    }
  });
</script>

<script type="module">
  import { db } from './firebase.js';
  import { doc, setDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js';

  async function saveDraftToFirestore() {
    const userId = localStorage.getItem('userId');
    if (!userId) {
      console.warn("No user logged in");
      return;
    }

    const draft = JSON.parse(localStorage.getItem('messageDraft') || '{}');
    if (!draft || Object.keys(draft).length === 0) {
      console.warn("No draft to save");
      return;
    }

    const id = Date.now().toString(); // unique ID per draft
    await setDoc(doc(db, "users", userId, "drafts", id), {
      ...draft,
      createdAt: serverTimestamp()
    });

    console.log("Draft saved to Firestore!");
  }

  // Optionally call after nextStep() or after sending to GPT:
  // await saveDraftToFirestore();
</script>





</body>
</html>
