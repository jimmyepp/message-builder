<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Framed Message Archive</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <nav class="global-nav">
  <a href="index.html">Start New Message</a>
  <span class="pipe">|</span>
  <a href="my-drafts.html">My Drafts</a>
  <span class="pipe">|</span>
  <a href="tools.html">Tools</a>
  <span class="pipe">|</span>
  <a href="profile.html">Settings</a>
</nav>

\
<table class="message-table">
  <thead>
    <tr>
      <th>Type</th>
      <th>Frame</th>
      <th>Influence</th>
      <th>Generated Response</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody id="messageTableBody"></tbody>
</table>


  <script>
  const draftId = new URLSearchParams(window.location.search).get("draftId");
  const draftKey = `draft-${draftId}`;
  const draft = JSON.parse(localStorage.getItem(draftKey)) || {};
  const messages = draft.messages || [];

  const tableBody = document.getElementById("messageTableBody");
  const searchInput = document.getElementById("searchInput");

  function renderTable(filteredMessages = messages) {
    tableBody.innerHTML = "";

    if (!filteredMessages.length) {
      const row = document.createElement("tr");
      const cell = document.createElement("td");
      cell.colSpan = 5;
      cell.textContent = "No messages found.";
      row.appendChild(cell);
      tableBody.appendChild(row);
      return;
    }

    filteredMessages.forEach((msg, index) => {
      const row = document.createElement("tr");

      const typeCell = document.createElement("td");
      typeCell.textContent = msg.format || "Unknown";

      const frameCell = document.createElement("td");
      frameCell.textContent = msg.frame || "None";

      const influenceCell = document.createElement("td");
      influenceCell.textContent = msg.influence || "None";

      const messageCell = document.createElement("td");
      const preview = document.createElement("div");
      preview.className = "preview-text";
      preview.textContent = (msg.generatedMessage || "").substring(0, 200) + "...";
      const full = document.createElement("pre");
      full.className = "full-text hidden";
      full.textContent = msg.generatedMessage || "";
      messageCell.appendChild(preview);
      messageCell.appendChild(full);

      const actionCell = document.createElement("td");
      const toggleBtn = document.createElement("button");
      toggleBtn.textContent = "Show";
      toggleBtn.onclick = () => {
        full.classList.toggle("hidden");
        preview.classList.toggle("hidden");
        toggleBtn.textContent = full.classList.contains("hidden") ? "Show" : "Hide";
      };

      const copyBtn = document.createElement("button");
      copyBtn.textContent = "Copy";
      copyBtn.onclick = () => {
        navigator.clipboard.writeText(msg.generatedMessage || "");
        copyBtn.textContent = "Copied!";
        setTimeout(() => (copyBtn.textContent = "Copy"), 1200);
      };

      actionCell.appendChild(toggleBtn);
      actionCell.appendChild(copyBtn);

      row.appendChild(typeCell);
      row.appendChild(frameCell);
      row.appendChild(influenceCell);
      row.appendChild(messageCell);
      row.appendChild(actionCell);

      tableBody.appendChild(row);
    });
  }

  // Search filtering
  searchInput.addEventListener("input", () => {
    const term = searchInput.value.toLowerCase();
    const filtered = messages.filter(
      (msg) =>
        msg.format?.toLowerCase().includes(term) ||
        msg.frame?.toLowerCase().includes(term) ||
        msg.influence?.toLowerCase().includes(term)
    );
    renderTable(filtered);
  });

  renderTable();
</script>

</body>
</html>
